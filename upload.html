<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title> Ø±ÙØ¹ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§ | MangaSanctum</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: radial-gradient(circle at top left, #1b1b2f, #151515);
      color: #eee;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    }
    h1, h3 {
      color: #8ef;
      text-align: center;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    input, textarea, select {
      padding: 0.5rem;
      border-radius: 8px;
      border: none;
      outline: none;
      background: #222;
      color: #fff;
    }
    .row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .col {
      flex: 1;
      min-width: 200px;
    }
    .small {
      max-width: 150px;
    }
    button {
      padding: 0.8rem;
      border: none;
      background: linear-gradient(90deg, #5ac8fa, #007aff);
      color: white;
      font-weight: bold;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: linear-gradient(90deg, #0af, #09f);
    }
    #msg {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.95rem;
    }
    .muted {
      color: #aaa;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <h1>ğŸ“– ØµÙØ­Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§</h1>

  <form id="mangaForm">
    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù†Ø¬Ø§</h3>

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù†Ø¬Ø§
      <input type="text" id="mangaName" required />
    </label>

    <label>Ø§Ù„ÙˆØµÙ
      <textarea id="mangaDesc" rows="4" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø§Ù†Ø¬Ø§..."></textarea>
    </label>

    <div class="row">
      <div class="col">
        <label>Ø§Ù„ÙˆØ³ÙˆÙ… (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)
          <input id="mangaTags" placeholder="Ù…Ø«Ø§Ù„: Ø´ÙˆÙ†ÙŠÙ†, Ø£ÙƒØ´Ù†, ÙƒÙˆÙ…ÙŠØ¯ÙŠØ§" />
        </label>
      </div>
      <div class="col small">
        <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©
          <select id="mangaAge">
            <option value="all">All</option>
            <option value="13+">13+</option>
            <option value="16+">16+</option>
            <option value="18+">18+</option>
          </select>
        </label>
      </div>
    </div>

    <label>ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (jpeg/png)
      <input type="file" id="coverFile" accept="image/*" />
    </label>

    <h3>Ø¥Ø¶Ø§ÙØ© ÙØµÙ„</h3>
    <div class="row">
      <div class="col small">
        <label>Ø±Ù‚Ù… Ø§Ù„ÙØµÙ„
          <input type="number" id="chapterNumber" value="1" min="1" required />
        </label>
      </div>
      <div class="col">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØµÙ„
          <input id="chapterTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØµÙ„" />
        </label>
      </div>
    </div>

    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø± (UTC)
      <input type="datetime-local" id="publishDate" />
      <div class="muted">Ø§ØªØ±Ùƒ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºÙ‹Ø§ Ù„ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ.</div>
    </label>

    <label>Ù…Ù„Ù Ø§Ù„ÙØµÙ„ (PDF)
      <input type="file" id="chapterFile" accept="application/pdf" required />
    </label>

    <div>
      <button type="button" id="submitBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ù†Ø¬Ø§ + Ø§Ù„ÙØµÙ„</button>
    </div>

    <p id="msg" class="muted"></p>
  </form>

  <script>
    const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZmkmqid6eFyceyjydW0pEFr672qC1JFX877b45z2wNicoivMw3WBxCNRTEdQVByFc/exec";

    function $(id) {
      return document.getElementById(id);
    }

    function showMsg(msg, type = "info") {
      const el = $("msg");
      el.textContent = msg;
      el.style.color = type === "error" ? "#f66" : type === "success" ? "#6f6" : "#aaa";
    }

    async function fileToBase64(file) {
      if (!file) return null;
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function collectForm() {
      const name = $("mangaName").value.trim();
      const desc = $("mangaDesc").value.trim();
      const tags = $("mangaTags").value.split(",").map(t => t.trim()).filter(Boolean);
      const age = $("mangaAge").value;
      const cover = await fileToBase64($("coverFile").files[0]);

      const chapterNum = $("chapterNumber").value;
      const chapterTitle = $("chapterTitle").value.trim();
      const chapterFile = await fileToBase64($("chapterFile").files[0]);
      const publishDate = $("publishDate").value || new Date().toISOString();

      return {
        manga: { name, desc, tags, age, cover, createdAt: new Date().toISOString() },
        chapter: { number: chapterNum, title: chapterTitle, publishDate, pdf: chapterFile }
      };
    }

    $("submitBtn").addEventListener("click", async () => {
      try {
        showMsg("ÙŠØªÙ… Ø§Ù„ØªØ­Ø¶ÙŠØ±... Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±");
        const payload = await collectForm();

        await fetch(APP_SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(payload),
        });

        showMsg("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…", "success");
        $("mangaForm").reset();
      } catch (e) {
        showMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: " + e, "error");
      }
    });
  </script>
</body>
</html>
