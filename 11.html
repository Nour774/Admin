<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إضافة مانجا | MangaSanctum</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #1c1b29, #0e0d16);
  font-family: "Segoe UI", sans-serif;
  color: #eee;
}
.container {
  max-width: 600px;
  margin: 60px auto;
  padding: 25px;
  backdrop-filter: blur(18px);
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 18px;
  box-shadow: 0 0 25px rgba(120, 80, 255, 0.25);
}
h1 {
  text-align: center;
  color: #bbaaff;
}
label {
  margin-top: 15px;
  display: block;
}
input, textarea {
  width: 100%;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 10px;
  padding: 10px;
  color: #eee;
  margin-top: 8px;
}
button {
  width: 100%;
  margin-top: 25px;
  padding: 12px;
  font-size: 17px;
  background: linear-gradient(135deg, #7d5cff, #6140ff);
  border: none;
  border-radius: 12px;
  color: #fff;
  cursor: pointer;
  transition: 0.3s;
  font-weight: bold;
}
button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
#status {
  margin-top: 15px;
  text-align: center;
  color: #ccbaff;
  font-weight: bold;
}
#coverPreview {
  margin-top: 12px;
  max-width: 100%;
  max-height: 180px;
  border-radius: 12px;
  display: none;
}
</style>
</head>
<body>

<div class="container">
  <h1>إضافة مانجا جديدة</h1>

  <label>اسم المانجا</label>
  <input id="mangaName" type="text">

  <label>الوصف</label>
  <textarea id="mangaDesc" rows="4"></textarea>

  <label>العمر المناسب</label>
  <input id="mangaAge" type="text" placeholder="مثال: 13+">

  <label>علامات مفصولة بفواصل</label>
  <input id="mangaTags" type="text">

  <label>غلاف المانجا</label>
  <input id="coverFile" type="file" accept="image/*">
  <img id="coverPreview">

  <button id="uploadBtn">إضافة</button>
  <div id="status"></div>
</div>

<script>
const coverFile = document.getElementById("coverFile");
const coverPreview = document.getElementById("coverPreview");
const statusBox = document.getElementById("status");

coverFile.addEventListener("change", () => {
  const file = coverFile.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => {
      coverPreview.src = e.target.result;
      coverPreview.style.display = "block";
    };
    reader.readAsDataURL(file);
  } else {
    coverPreview.style.display = "none";
  }
});

document.getElementById("uploadBtn").addEventListener("click", async () => {

  const name = mangaName.value.trim();
  const desc = mangaDesc.value.trim();
  const age  = mangaAge.value.trim();
  const tags = mangaTags.value.trim();
  const file = coverFile.files[0];

  if (!name || !desc || !file) {
    statusBox.innerHTML = "⚠️ يرجى ملء جميع الحقول الضرورية.";
    return;
  }

  uploadBtn.disabled = true;
  statusBox.innerHTML = "⏳ جاري رفع المانجا…";

  const form = new FormData();
  form.append("action", "addManga");
  form.append("name", name);
  form.append("desc", desc);
  form.append("age", age);
  form.append("tags", tags);
  form.append("cover", file);

  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbyVnf6R1grf9z6sr2SSb6sea0Z-L6XdrGjpg31vcp19PtJnG0hHTuX896Aa1rusd7Dqkg/exec", {
      method: "POST",
      body: form
    });

    if (!res.ok) {
      statusBox.innerHTML = "❌ فشل الاتصال بالخادم.";
      uploadBtn.disabled = false;
      return;
    }

    const data = await res.json();

    if (data.status === "success") {
      statusBox.innerHTML = "✔️ تم إضافة المانجا بنجاح!";
      mangaName.value = "";
      mangaDesc.value = "";
      mangaAge.value = "";
      mangaTags.value = "";
      coverFile.value = "";
      coverPreview.style.display = "none";
    } else {
      statusBox.innerHTML = "❌ خطأ: " + data.message;
    }

  } catch (err) {
    statusBox.innerHTML = "❌ حدث خطأ: لم نتمكن من إرسال البيانات.";
  }

  uploadBtn.disabled = false;
});
</script>

</body>
</html>
